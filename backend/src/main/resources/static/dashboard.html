<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"  rel="stylesheet">
</head>
<body class="container mt-5">

<h2>Bienvenido, <span id="userName"></span></h2>
<button onclick="logout()" class="btn btn-danger">Cerrar sesión</button>

<hr>

<h5>Agregar Registro con Comida</h5>
<input id="fechaRegistro" type="date" class="form-control mb-2">
<input id="horarioRegistro" type="time" class="form-control mb-2">

<!-- Campo de búsqueda de alimento -->
<input id="searchAlimento" type="text" placeholder="Buscar alimento..." class="form-control mb-2" oninput="buscarAlimentos(this.value)">
<div id="suggestionsContainer" class="mb-3"></div>

<!-- Campos manuales -->
<input id="manualNombre" placeholder="Nombre del alimento" class="form-control mb-2">
<input id="manualCalorias" placeholder="Calorías por 100g" type="number" step="0.01" class="form-control mb-2">
<input id="manualProteinas" placeholder="Proteínas (g)" type="number" step="0.01" class="form-control mb-2">
<input id="manualCarbohidratos" placeholder="Carbohidratos (g)" type="number" step="0.01" class="form-control mb-2">
<input id="manualGrasas" placeholder="Grasas (g)" type="number" step="0.01" class="form-control mb-2">
<input id="manualCantidad" placeholder="Cantidad (g/ml)" type="number" step="0.01" class="form-control mb-2">

<button onclick="crearRegistroConComida()" class="btn btn-primary">Guardar Registro</button>

<hr>

<!-- Lista de registros -->
<h4>Tus Registros</h4>
<div id="registroList" class="mt-4"></div>

<script src="js/app.js"></script>
<script>
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));

    if (!currentUser) {
        window.location.href = "index.html";
    } else {
        document.getElementById("userName").innerText = currentUser.nombre || "Usuario";
    }

    function cargarRegistros() {
        fetch(`/api/registros/alimentos?idUsuario=${currentUser.id}`)
            .then(res => res.json())
            .then(registros => {
                const container = document.getElementById("registroList");
                container.innerHTML = "";

                if (!registros.length) {
                    container.innerHTML = "<p>No tienes registros aún.</p>";
                    return;
                }

                registros.forEach(r => {
                    const div = document.createElement("div");
                    div.className = "card p-3 mb-2";

                    div.innerHTML = `
                        <strong>${r.fecha}</strong> - ${r.horario}<br>
                        <b>${r.nombreAlimento}</b><br>
                        Cantidad: ${r.cantidad}g<br>
                        Calorías: ${(r.caloriasTotales || 0).toFixed(2)} kcal
                    `;
                    container.appendChild(div);
                });
            })
            .catch(err => {
                console.error("Error cargando registros:", err);
            });
    }

    window.onload = () => {
        cargarRegistros();
    };
</script>
</body>
</html>